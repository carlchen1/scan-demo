<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>条码扫码</title>
<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>
<style>
  body { font-family: Arial; padding: 10px; }
  #scanner-container { width: 100%; height: 400px; border: 2px solid #333; position: relative; }
  #camera-select { margin-bottom: 10px; }
  #result { margin-top: 10px; font-size: 18px; color: green; }
</style>
</head>
<body>

<h2>条码扫码</h2>
<select id="camera-select"></select>
<div id="scanner-container"></div>
<div id="result">扫描结果会显示在这里</div>

<audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let currentCameraId = null;

// 获取可用摄像头
Quagga.CameraAccess.enumerateVideoDevices().then(function(devices) {
    const select = document.getElementById('camera-select');
    devices.forEach((device, i) => {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.text = device.label || `摄像头 ${i+1}`;
        select.appendChild(option);
    });
    if(devices.length > 0){
        currentCameraId = devices[0].deviceId;
        startScanner(currentCameraId);
    }
});

// 切换摄像头
document.getElementById('camera-select').addEventListener('change', function(){
    currentCameraId = this.value;
    Quagga.stop();
    startScanner(currentCameraId);
});

function startScanner(cameraId){
    Quagga.init({
        inputStream: {
            type: "LiveStream",
            target: document.querySelector('#scanner-container'),
            constraints: {
                width: 1280,
                height: 720,
                facingMode: "environment",
                deviceId: cameraId
            }
        },
        decoder: {
            readers: [
                "code_128_reader",   // Code128A/B/C
                "code_39_reader",    // Code39
                "ean_reader",        // EAN-13
                "ean_8_reader",      // EAN-8
                "upc_reader",        // UPC-A
                "upc_e_reader"       // UPC-E
            ]
        },
        locate: true,
        numOfWorkers: navigator.hardwareConcurrency || 4
    }, function(err){
        if(err){ console.error(err); return; }
        Quagga.start();
    });

    // 扫描回调
    Quagga.onDetected(function(result){
        const code = result.codeResult.code;
        console.log("扫描到条码:", code);
        document.getElementById('result').textContent = "扫码结果：" + code;

        // 播放提示音
        document.getElementById('beep-sound').play().catch(()=>{});

        // 手机震动
        if(navigator.vibrate){
            navigator.vibrate(200);
        }

        // 停止扫描
        Quagga.stop();
    });
}
</script>

</body>
</html>


