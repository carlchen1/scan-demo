<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>条码扫码</title>
<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>
<style>
  body { font-family: Arial; padding: 10px; }
  #scanner-container {
    width: 100%;
    height: 400px;
    border: 2px solid #333;
    position: relative;
    overflow: hidden;
  }
  #camera-select { margin-bottom: 10px; }
  #result { margin-top: 10px; font-size: 18px; color: green; }

  /* 扫码框样式 */
  #scan-box {
    position: absolute;
    border: 2px solid red;
    width: 70%;
    height: 40%;
    top: 30%;
    left: 15%;
    box-sizing: border-box;
    pointer-events: none; /* 不阻挡摄像头点击 */
  }
</style>
</head>
<body>

<h2>条码扫码</h2>
<select id="camera-select"></select>
<div id="scanner-container">
  <div id="scan-box"></div>
</div>
<div id="result">扫描结果会显示在这里</div>
<audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let currentCameraId = null;

// 获取摄像头列表
Quagga.CameraAccess.enumerateVideoDevices().then(devices => {
    const select = document.getElementById('camera-select');
    devices.forEach((device, i) => {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.text = device.label || `摄像头 ${i+1}`;
        select.appendChild(option);
    });
    if(devices.length > 0){
        currentCameraId = devices[0].deviceId;
        startScanner(currentCameraId);
    }
});

// 切换摄像头
document.getElementById('camera-select').addEventListener('change', function(){
    currentCameraId = this.value;
    Quagga.stop();
    startScanner(currentCameraId);
});

function startScanner(cameraId){
    const container = document.querySelector('#scanner-container');
    const scanBox = document.querySelector('#scan-box');

    Quagga.init({
        inputStream: {
            type: "LiveStream",
            target: container,
            constraints: {
                width: 1280,
                height: 720,
                facingMode: "environment",
                deviceId: cameraId
            }
        },
        locator: {
            patchSize: "medium",
            halfSample: true
        },
        numOfWorkers: navigator.hardwareConcurrency || 4,
        decoder: {
            readers: [
                "code_128_reader",
                "code_39_reader",
                "ean_reader",
                "ean_8_reader",
                "upc_reader",
                "upc_e_reader"
            ]
        },
        locate: true
    }, function(err){
        if(err){ console.error(err); return; }
        Quagga.start();
    });

    // 扫描回调
    Quagga.onDetected(function(result){
        const code = result.codeResult.code;
        console.log("扫描到条码:", code);
        document.getElementById('result').textContent = "扫码结果：" + code;

        // 播放提示音
        document.getElementById('beep-sound').play().catch(()=>{});

        // 手机震动
        if(navigator.vibrate){
            navigator.vibrate(200);
        }

        // 停止扫描
        Quagga.stop();
    });

    // 限制扫描区域到扫码框
    Quagga.onProcessed(function(result){
        if(result && result.boxes){
            // 可选：在扫码框里绘制识别框
        }
    });
}
</script>

</body>
</html>



