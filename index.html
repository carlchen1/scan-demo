<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>条码扫码 H5</title>
<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>
<style>
  body { font-family: Arial; padding: 10px; background: #f5f5f5; }
  #camera-select { margin-bottom: 10px; width: 100%; padding: 5px; font-size: 16px; }
  #scanner-container { 
      width: 100%; 
      max-width: 600px; 
      height: 400px; 
      margin: 0 auto; 
      border: 2px solid #333; 
      position: relative; 
      overflow: hidden; 
      background: #000; 
  }
  #scan-box { 
      position: absolute; 
      border: 2px solid red; 
      width: 70%; 
      height: 40%; 
      top: 30%; 
      left: 15%; 
      box-sizing: border-box; 
      pointer-events: none; 
  }
  #result { margin-top: 10px; font-size: 18px; color: green; text-align: center; }
</style>
</head>
<body>

<h2 style="text-align:center;">条码扫码 H5</h2>
<select id="camera-select"></select>
<div id="scanner-container">
  <div id="scan-box"></div>
</div>
<div id="result">扫码结果会显示在这里</div>

<audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let currentCameraId = null;

// 获取可用摄像头列表
Quagga.CameraAccess.enumerateVideoDevices().then(devices => {
    const select = document.getElementById('camera-select');
    devices.forEach((device, i) => {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.text = device.label || `摄像头 ${i+1}`;
        select.appendChild(option);
    });
    if(devices.length > 0){
        currentCameraId = devices[0].deviceId;
        startScanner(currentCameraId);
    }
});

// 切换摄像头
document.getElementById('camera-select').addEventListener('change', function(){
    currentCameraId = this.value;
    Quagga.stop();
    startScanner(currentCameraId);
});

// 启动扫码
function startScanner(cameraId){
    const container = document.querySelector('#scanner-container');

    Quagga.init({
        inputStream: {
            type: "LiveStream",
            target: container,
            constraints: {
                width: 1280,
                height: 720,
                facingMode: "environment",
                deviceId: cameraId
            },
            area: { // 限制扫描区域为红色扫码框
                top: "30%",
                right: "15%",
                left: "15%",
                bottom: "30%"
            }
        },
        locator: {
            patchSize: "medium",
            halfSample: true
        },
        numOfWorkers: navigator.hardwareConcurrency || 4,
        decoder: {
            readers: [
                "code_128_reader",   // Code128A/B/C
                "code_39_reader",    // Code39
                "ean_reader",        // EAN-13
                "ean_8_reader",      // EAN-8
                "upc_reader",        // UPC-A
                "upc_e_reader"       // UPC-E
            ]
        },
        locate: true
    }, function(err){
        if(err){ console.error(err); return; }
        Quagga.start();
    });

    // 扫描成功回调
    Quagga.onDetected(function(result){
        const code = result.codeResult.code;
        console.log("扫描到条码:", code);
        document.getElementById('result').textContent = "扫码结果：" + code;

        // 播放提示音
        document.getElementById('beep-sound').play().catch(()=>{});

        // 手机震动
        if(navigator.vibrate){
            navigator.vibrate(200);
        }

        // 停止扫描
        Quagga.stop();
    });
}
</script>

</body>
</html>




